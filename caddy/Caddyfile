{
	auto_https disable_certs
}

clic.epfl.ch {
	tls {$SSL_CERTIFICATE_PATH} {$SSL_KEY_PATH}

	handle_path /nextcloud* {
		header {
			Strict-Transport-Security max-age=31536000;
		}

		reverse_proxy http://nextcloud:80
	}

	handle /.well-known {
		redir /.well-known/carddav /nextcloud/remote.php/dav/ permanent
		redir /.well-known/caldav /nextcloud/remote.php/dav/ permanent
	}

	reverse_proxy /mattermost* http://mattermost:8065

	redir /amoire /armoire/ permanent
	reverse_proxy /armoire* http://vaultwarden:80

	reverse_proxy /* http://website:8000

	redir /wiki* https://clic.epfl.ch/
}

clic.epfl.ch:8443 {
	tls {$SSL_CERTIFICATE_PATH} {$SSL_KEY_PATH}

	reverse_proxy /* http://wiki:80
}
