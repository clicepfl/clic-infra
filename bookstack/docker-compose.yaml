services:
  bookstack:
    image: lscr.io/linuxserver/bookstack
    host_name: bookstack
    environment:
      PUID: 1000
      PGID: 1000
      APP_URL: https://clic.epfl.ch/bookstack
      DB_HOST: database
      DB_PORT: 3306
      DB_USER: bookstack
      DB_PASS: ${BOOKSTACK_DATABASE_PASSWORD}
      DB_DATABASE: bookstackapp
    volumes:
      - app:/config
    networks:
      default:
      caddy:
    depends_on:
      - database

  database:
    image: lscr.io/linuxserver/mariadb
    host_name: database
    environment:
      PUID: 1000
      PGID: 1000
      MYSQL_ROOT_PASSWORD: ${BOOKSTACK_DATABASE_PASSWORD}
      TZ: Europe/London
      MYSQL_DATABASE: bookstackapp
      MYSQL_USER: bookstack
      MYSQL_PASSWORD: ${BOOKSTACK_DATABASE_PASSWORD}
    volumes:
      - database:/config
      - ${BOOKSTACK_DATABASE_INIT}:/docker-entrypoint-initdb.d
    ports:
      - 5004:3306

volumes:
  database:
  app:
networks:
  caddy:
    external: true
